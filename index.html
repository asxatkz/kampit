<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        input, button {
            margin: 8px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 250px;
            transition: all 0.3s ease;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            padding: 12px 25px;
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
    </style>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        const CLIENT_ID = '182123418974-9e7qbmj17i0qi9gj44ctedr41d5a34fm.apps.googleusercontent.com'; // –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à OAuth Client ID
        const API_KEY = 'AIzaSyDk9XMOKbXaH_pFGUYv_D3NnnLbtnUcbEM'; // –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à API Key
        const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: DISCOVERY_DOCS,
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // defined later
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById("authorize_button").style.display = 'block';
            }
        }

        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    throw (resp);
                }
                document.getElementById("authorize_button").innerText = 'Refresh';
                await loadBalanceMorning();
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        async function loadBalanceMorning() {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: '1QZcNpX9d8NCqViHPAI9FK8uGNuMRBb7bWt5r4shu9qk',
                    range: 'Sheet1!L2',
                });
                const value = response.result.values ? response.result.values[0][0] : 0;
                document.getElementById("balanceMorning").value = value;
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å—Ç–∞—Ç–∫–∞:", err);
            }
        }

        async function sendData() {
            try {
                let data = [
                    document.getElementById("date").value,
                    parseFloat(document.getElementById("balanceMorning").value) || 0,
                    parseFloat(document.getElementById("terminal").value) || 0,
                    parseFloat(document.getElementById("cash").value) || 0,
                    parseFloat(document.getElementById("transfers").value) || 0,
                    parseFloat(document.getElementById("purchaseCash").value) || 0,
                    parseFloat(document.getElementById("purchaseNonCash").value) || 0,
                    parseFloat(document.getElementById("salaryAltynai").value) || 0,
                    parseFloat(document.getElementById("salarySamal").value) || 0,
                    parseFloat(document.getElementById("otherExpenses").value) || 0,
                    parseFloat(document.getElementById("revenue").value) || 0,
                    parseFloat(document.getElementById("balanceTomorrow").value) || 0,
                ];

                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: '1QZcNpX9d8NCqViHPAI9FK8uGNuMRBb7bWt5r4shu9qk',
                    range: 'Sheet1!A:L',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [data],
                    },
                });

                alert("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err);
                alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö!");
            }
        }

        function setDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById("date").value = today;
        }

        document.addEventListener("DOMContentLoaded", function() {
            setDate();
            gapiLoaded();
            gisLoaded();
        });
    </script>
</head>
<body>
    <h1>üìä –£—á–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞</h1>

    <!-- –î–∞—Ç–∞ –∏ –û—Å—Ç–∞—Ç–æ–∫ -->
    <div class="section">
        <h2>üìÖ –î–∞—Ç–∞ –∏ –û—Å—Ç–∞—Ç–æ–∫</h2>
        <label>üìÖ –î–∞—Ç–∞: <input type="date" id="date" readonly></label>
        <label>üí∞ –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —É—Ç—Ä–æ: <input type="number" id="balanceMorning" readonly></label>
    </div>

    <!-- –ü—Ä–æ–¥–∞–∂–∏ -->
    <div class="section">
        <h2>üíµ –ü—Ä–æ–¥–∞–∂–∏</h2>
        <label>üí≥ –¢–µ—Ä–º–∏–Ω–∞–ª: <input type="number" id="terminal"></label>
        <label>üíµ –ù–∞–ª–∏—á–Ω—ã–µ: <input type="number" id="cash"></label>
        <label>üì≤ –ü–µ—Ä–µ–≤–æ–¥—ã: <input type="number" id="transfers"></label>
    </div>

    <!-- –ó–∞–∫—É–ø–∫–∏ -->
    <div class="section">
        <h2>üì¶ –ó–∞–∫—É–ø–∫–∏</h2>
        <label>üè¢ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: <input type="text" id="supplier"></label>
        <label>üí∞ –ó–∞–∫—É–ø –∑–∞ –Ω–∞–ª: <input type="number" id="purchaseCash"></label>
        <label>üí≥ –ó–∞–∫—É–ø –∑–∞ –±–µ–∑–Ω–∞–ª: <input type="number" id="purchaseNonCash"></label>
        <label>üè∑Ô∏è –†–æ–∑–Ω–∏—á–Ω–∞—è —Ü–µ–Ω–∞: <input type="number" id="retailPrice"></label>
    </div>

    <!-- –†–∞—Å—Ö–æ–¥—ã -->
    <div class="section">
        <h2>üë• –†–∞—Å—Ö–æ–¥—ã</h2>
        <label>üë©‚Äçüíº –ó–∞—Ä–ø–ª–∞—Ç–∞ –ê–ª—Ç—ã–Ω–∞–π: <input type="number" id="salaryAltynai"></label>
        <label>üë©‚Äçüíª –ó–∞—Ä–ø–ª–∞—Ç–∞ –°–∞–º–∞–ª: <input type="number" id="salarySamal"></label>
        <label>üí∏ –ü—Ä–æ—á–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: <input type="number" id="otherExpenses"></label>
    </div>

    <!-- –ò—Ç–æ–≥ -->
    <div class="section">
        <h2>üìä –ò—Ç–æ–≥</h2>
        <label>üí∞ –í—ã—Ä—É—á–∫–∞: <input type="number" id="revenue" readonly></label>
        <label>üí∞ –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –∑–∞–≤—Ç—Ä–∞: <input type="number" id="balanceTomorrow" readonly></label>
    </div>

    <button id="authorize_button" style="display: none;" onclick="handleAuthClick()">Authorize</button>
    <button onclick="sendData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç</button>
</body>
</html>
