<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Остаток наличных</title>
    <style>
        .message {
            margin-top: 10px;
            padding: 10px;
            display: none;
        }
        .success {
            color: green;
            background-color: #e8f5e9;
            border: 1px solid #81c784;
            border-radius: 4px;
        }
        .error {
            color: red;
            background-color: #ffebee;
            border: 1px solid #e57373;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h2>Выберите дату:</h2>
    <input type="date" id="datePicker">
    
    <h3>Остаток наличных: <span id="cashBalance">—</span></h3>
    
    <label>Продажи: <input type="number" id="sales" value="0"></label><br>
    <label>Расходы: <input type="number" id="expenses" value="0"></label><br>
    
    <button onclick="calculateTotal()">Рассчитать итог</button>
    
    <h3>Итоговая сумма: <span id="totalBalance">—</span></h3>
    
    <button onclick="saveToSheet()">Сохранить в таблицу</button>
    
    <!-- Добавляем элемент для сообщений -->
    <div id="statusMessage" class="message"></div>

    <script>
        // ... (предыдущий код без изменений до функции showMessage)

        // Функция для показа сообщения
        function showMessage(message, isError = false) {
            const messageElement = document.getElementById('statusMessage');
            messageElement.textContent = message;
            messageElement.className = 'message ' + (isError ? 'error' : 'success');
            messageElement.style.display = 'block';
            
            // Автоматически скрываем сообщение через 3 секунды
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 3000);
        }

        function saveToSheet() {
            const totalBalance = document.getElementById("totalBalance").innerText;
            if (selectedRow === 0 || totalBalance === "—") {
                showMessage("Выберите дату и рассчитайте итог!", true);
                return;
            }

            const selectedDate = new Date(document.getElementById("datePicker").value);
            const currentMonth = getSheetNameForMonth(selectedDate);

            const form = document.createElement('form');
            form.method = 'POST';
            form.action = GAS_URL;
            form.target = 'hidden_iframe';

            let iframe = document.getElementById('hidden_iframe');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.name = 'hidden_iframe';
                iframe.id = 'hidden_iframe';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
            }

            const addField = (name, value) => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = name;
                input.value = value;
                form.appendChild(input);
            };

            addField('row', selectedRow);
            addField('value', totalBalance);
            addField('sales', document.getElementById("sales").value);
            addField('expenses', document.getElementById("expenses").value);
            addField('month', currentMonth);

            // Показываем сообщение о процессе сохранения
            showMessage("Сохранение данных...");

            document.body.appendChild(form);
            form.submit();

            setTimeout(() => {
                document.body.removeChild(form);
                setTimeout(async () => {
                    await loadPreviousDayData(selectedDate);
                    showMessage("Данные успешно сохранены!");
                    
                    // Очищаем поля после успешного сохранения
                    document.getElementById("sales").value = "0";
                    document.getElementById("expenses").value = "0";
                    document.getElementById("totalBalance").innerText = "—";
                }, 2000);
            }, 100);
        }

        // ... (остальной код остается без изменений)
    </script>
</body>
</html>
