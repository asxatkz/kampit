<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Кассовый учет</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 20px auto; padding: 20px; }
        .section { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; }
        input, button { margin: 5px; padding: 8px; width: 200px; }
        .balance { font-size: 20px; color: #27ae60; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Ежедневный отчет</h1>
    
    <div class="section">
        <div>
            <label>Дата: <input type="date" id="date" required></label>
        </div>
        <div>
            Остаток за вчера: <span class="balance" id="lastBalance">...</span>
        </div>
    </div>

    <div class="section">
        <h3>Продажи</h3>
        <label>Терминал: <input type="number" id="terminal" required></label><br>
        <label>Наличные: <input type="number" id="cash" required></label><br>
        <label>Переводы: <input type="number" id="transfers" required></label>
    </div>

    <div class="section">
        <h3>Расходы</h3>
        <label>Закупки: <input type="number" id="purchases" required></label><br>
        <label>Зарплаты: <input type="number" id="salary" required></label>
    </div>

    <div class="section">
        <h3>Итоги</h3>
        Выручка: <span class="balance" id="revenue">0</span><br>
        Остаток на конец дня: <span class="balance" id="endBalance">0</span>
    </div>

    <button onclick="saveData()">Сохранить отчет</button>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyFQdMdUSFFHri6NFvBJ8_71YnfWAW1b70NI_iOoAGH6J5dI_yndwoiOO_k_x6o0Q4bGQ/exec';
        
        // Загрузка остатка при открытии
        fetch(SCRIPT_URL)
            .then(r => r.json())
            .then(data => {
                document.getElementById('lastBalance').textContent = data.lastBalance;
                calculate();
            });

        // Автоматический расчет
        function calculate() {
            const lastBalance = parseFloat(document.getElementById('lastBalance').textContent) || 0;
            const terminal = parseFloat(document.getElementById('terminal').value) || 0;
            const cash = parseFloat(document.getElementById('cash').value) || 0;
            const transfers = parseFloat(document.getElementById('transfers').value) || 0;
            const purchases = parseFloat(document.getElementById('purchases').value) || 0;
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            
            const revenue = (terminal + cash + transfers) - purchases - salary;
            const endBalance = lastBalance + revenue;
            
            document.getElementById('revenue').textContent = revenue;
            document.getElementById('endBalance').textContent = endBalance;
        }

        // Обработчики изменений
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calculate);
        });

        // Сохранение данных
        async function saveData() {
            const data = {
                date: document.getElementById('date').value,
                startBalance: parseFloat(document.getElementById('lastBalance').textContent),
                terminal: parseFloat(document.getElementById('terminal').value),
                cash: parseFloat(document.getElementById('cash').value),
                transfers: parseFloat(document.getElementById('transfers').value),
                purchases: parseFloat(document.getElementById('purchases').value),
                salary: parseFloat(document.getElementById('salary').value),
                revenue: parseFloat(document.getElementById('revenue').textContent),
                endBalance: parseFloat(document.getElementById('endBalance').textContent)
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if(result.status === 'success') {
                    alert('Данные сохранены!');
                    location.reload();
                }
            } catch (error) {
                alert('Ошибка: ' + error.message);
            }
        }
    </script>
</body>
</html>
